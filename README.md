# Функциональные требования MVP
1. Создание и редактирование workflow (ноды / рёбра)
Пользователь может:

создать новый workflow;

добавлять ноды на canvas;

соединять ноды ребрами;

удалять ноды и связи;

редактировать параметры ноды (URL, данные, переменные, код и т.п.);

перемещать ноды по canvas;

сохранять workflow.

Обязательные условия:

визуальный редактор (drag & drop);

проверка связности графа (необязательно строгая, но базовая валидация);

сериализация графа в хранилище (в БД/JSON);

загрузка графа из хранилища.

2. Триггеры workflow
Поддержка трёх типов триггеров:
2.1. Ручной запуск

кнопка "Run" в UI;

возможность указать входные параметры (опционально);

запуск создаёт новый execution (run-id), который попадает в очередь выполнения.

2.2. Scheduler

простой cron- или interval-based запуск:

форматы: каждые N секунд/минут/часов,

cron-строка (базовая поддержка);

планировщик создаёт новые executions в нужное время.

2.3. Webhook

автоматическая генерация URL для приема POST-запросов;

входное тело (JSON) сохраняется в контекст выполнения;

вызов вебхука создаёт execution.

3. HTTP Node (основной интеграционный узел)
Должны поддерживаться:

методы: GET, POST (оставить PUT/DELETE на позже);

URL;

headers (key/value);

body (строка или JSON);

таймаут;

сохранение ответа в контекст;

статус, тело, ошибки.

Пайплайн данных:

можно использовать значения из контекста как переменные в URL/headers/body;

результат HTTP-запроса доступен следующим узлам.

4. Полный просмотр стейта выполнения
Для каждого execution пользователь может:

видеть список узлов, которые выполнялись;

видеть входные данные ноды (input);

видеть выходные данные ноды (output);

видеть ошибки, если были;

видеть глобальный контекст выполнения;

видеть изменения состояния после каждой ноды (state diff можно позже, но хотя бы полный снимок).

Форматы отображения:

дерево/лист нод;

JSON-представление контекста;

log view.

5. Потоки данных (data streams / переменные)

Это фундамент движка.

Движок должен поддерживать:

глобальный контекст workflow-run (map/JSON);

запись переменных в контекст через ноды;

чтение переменных нодами из контекста;

возможность хранить большие объекты (JSON);

типы данных: string, number, bool, object, list;

автоматическое прокидывание контекста от ноды к ноде.

Ноды должны иметь доступ к:

input context,

output context,

контексту других нод через ключи.

6. Code Node (Python) с песочницей
Пользователь может писать Python-код, который:

получает входной контекст (input);

возвращает изменённый контекст (output);

не может:

обращаться к файловой системе,

выходить в сеть,

запускать бесконечные циклы.

Требования к песочнице:

ограничение CPU time (например, 100–300 ms);

ограничение памяти;

whitelisted-библиотеки (например, math, json);

автоматический kill при нарушении ограничений.

Технически:

изоляция в subprocess / jailed интерпретаторе;

безопасный bridge между движком и Python.

7. Параллельное исполнение нод
Требования:

если граф имеет ветвление (например, от одного узла идут 2+ исходящих ребра),
— эти ветки должны выполняться параллельно.

Нужно поддержать:

запуск независимых нод в разных worker-тредах/процессах;

сбор результатов в join-точке (если есть);

корректную работу с контекстом:

либо копия контекста на ветку,

либо merge (определённая стратегия минимального объединения).

Нефункционально:

worker-пул;

promise/future для узлов;

безопасные merge стратегии.
